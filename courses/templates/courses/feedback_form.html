{% load crispy_forms_tags %}

{% if user.is_authenticated %}
  {% if can_review %}
    <section class="mt-4">
      <h3 class="h5">Leave your feedback</h3>
      <form method="post" action="{% url 'courses:course_feedback_create' course.id %}">
        {% csrf_token %}
        {% crispy feedback_form %}
        <button type="submit" class="btn btn-primary mt-2">Submit</button>
      </form>
    </section>
  {% elif is_enrolled and already_reviewed %}
    <p class="text-muted mt-3"><em>You’ve already reviewed this course.</em></p>
  {% elif is_enrolled %}
    {# enrolled but no form provided — unlikely, but safe to handle #}
  {% else %}
    <p class="text-muted mt-3">Enroll to leave feedback.</p>
  {% endif %}
{% else %}
  <p class="mt-3">
    <a href="{% url 'login' %}?next={{ request.path }}">Log in</a> to leave feedback.
  </p>
{% endif %}
